<div class="container">
  <% if (error != undefined || error != null) { %>
    <div class="notification is-danger is-light" id="error">
      <%= error %>
    </div>
  <% } %>
  <% if(action=='create' || action=='edit'){ %> 
    <div class="columns">
      <div class="column">
        <div class="container">
          <br />
          <h4 class="title is-4">Crear Plan</h4>
          <hr>
          <% if(action=='create') { %>
            <form action="/plan/create" method="POST">
          <% } %>
          <% if(action=='edit') { %>
            <form action="/plan/edit/<%= plan.id %>" method="POST">
          <% } %>
            <div class="box">
              <div class="columns">
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">Nombre</label>
                    <div class="control">
                      <input class="input is-capitalized is-size-7" type="text" name="name" required="true" placeholder="Nombre del Plan" <% if(action=='edit'){ %>value="<%= plan.name %>"<% }%>/>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">Días Gratis</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="number" step="any" name="trialDays" placeholder="Número de días gratis" required <% if(action=='edit'){ %>value="<%= plan.trialDays %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class='bx bx-donate-heart'></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">Precio Suscripción USD</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="number" step="any" name="pricesubscription" placeholder="Suscripción USD" required <% if(action=='edit'){ %>value="<%= plan.pricesubscription %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class="bx bxs-badge-dollar"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">Precio Setup USD</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="number" step="any" name="price" placeholder="Setup USD" required <% if(action=='edit'){ %>value="<%= plan.price %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class="bx bxs-badge-dollar"></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="field">
                    <div class="control">
                      <label class="label is-size-7">Visible</label>
                      <input id="visible" type="checkbox" name="visible" class="switch is-success" <% if(action=='edit' && plan.visible){%>checked<%}%>>
                      <label for="visible"></label>
                    </div>
                  </div>
                </div>
                <div class="column"> 
                  <div class="field">
                    <label class="label is-size-7">Descripción</label>
                    <div class="control">
                      <textarea class="textarea is-size-7" name="description" placeholder="Descripción del plan"><%if(action=='edit'){%><%-plan.description%><%}%></textarea>
                    </div>
                  </div>
                </div>
              </div>
              <br>
              <h6 class="title is-6">Opciones del plan</h4>
              <hr>
              <div class="columns">
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">Productos</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="text" name="products" placeholder="Agregar solo el número o ilimitado"  required <% if(action=='edit'){ %>value="<%= plan.products %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class='bx bxs-package'></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="column"> 
                  <div class="field">
                    <label class="label is-size-7">Canales/Cuentas</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="text" name="channels" placeholder="Agregar solo el número o ilimitado" required <% if(action=='edit'){ %>value="<%= plan.channels %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class='bx bxs-shopping-bags'></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="column"></div>
              </div>
              <br>
              <h6 class="title is-6">Lanzamiento</h4>
              <hr>
              <div class="columns">
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">On-boarding personalizado</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="text" name="onboarding" placeholder="Días de On-boarding" required <% if(action=='edit'){ %>value="<%= plan.products %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class='bx bxs-user-badge'></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="column"> 
                  <div class="field">
                    <label class="label is-size-7">Integración ERP</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="text" name="erp" placeholder="Costo Integración ERP" required <% if(action=='edit'){ %>value="<%= plan.channels %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class='bx bx-window-open'></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="field">
                    <label class="label is-size-7">Soporte</label>
                    <div class="control has-icons-left">
                      <input class="input is-size-7" type="text" name="support" placeholder="Soporte" required <% if(action=='edit'){ %>value="<%= plan.channels %>"<% }%>/>
                      <span class="icon-input-left is-small is-left">
                        <i class='bx bx-support'></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="control buttons is-right">
                <% if(action=='edit'){ %> 
                  <button type="submit" class="button is-primary"><i class="bx bxs-pencil"></i>&nbsp;Modificar Plan</button>
                <% }else if (action=='create'){ %>
                  <button type="submit" class="button is-primary"><i class="bx bx-plus-circle"></i>&nbsp;Crear Plan</button>
                <% } %>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  <% } else { %>
    <p style="text-align: right;font-size: 20px; margin-right: 5px;">
      <a href="/plans/create" class="has-text-primary"><i class='bx bxs-plus-square'></i></a>
    </p>
    <div class="table-container is-size-7">
      <table class="table is-hoverable" id="countries-table">
        <thead>
          <tr>
            <th scope="col">Nombre</th>
            <th scope="col">Precio Setup USD</th>
            <th scope="col">Precio Suscripción USD</th>
            <th scope="col">Opciones</th>
          </tr>
        </thead>
        <tbody>
          <% plans.forEach(function(plan){ %>
            <tr>
              <td class="align-middle is-capitalized"><%= plan.name %></td>
              <td class="align-middle"><%= plan.price %></td>
              <td class="align-middle"><%= plan.pricesubscription %></td>
              <td class="align-middle">
                <a href="/plans/edit/<%= plan.id %>" class="button is-small">
                  <span class="icon">
                    <i class="bx bxs-edit"></i>
                  </span>
                </a>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        let table = new simpleDatatables.DataTable('#countries-table',{
        searchable:true,
        sortable:true,
        paging:true,
        labels: {
          placeholder: "Buscar...",
          perPage: "{select} registros por página",
          noRows: "No se encontraron datos",
          info: "Mostrando {start} a {end} de {rows} registros",
        }
        });  
      });
    </script>
  <% } %>
  <script>
    setTimeout(function() {
      var el = document.getElementById('error');
      if(el){
        el.style.display='none';
      }
    }, 4000);
  </script>
</div>
