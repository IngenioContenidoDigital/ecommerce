<div class="container">
    <%if(object.products.length<1){%>
    <div class="columns is-gapless">
        <div class="column is-centered is-gapless">
            <br> <br>
            <div class="container is-fluid">
                <h4 class="title is-4">Tu búsqueda no arrojó ningún resultado.</h4>
                <p class="box">Lo sentimos, no hemos localizado ningun resultado para <span class="is-italic has-text-weight-bold"><%if(typeof object.search ==='string'){%><%= object.search %><%}else{%>esta opción<%}%></span>. Intenta nuevamente.</p>
            </div>
            <hr>
        </div>
    </div>
    <%}else{%>
    <div class="columns is-centered is-gapless">
        <div class="column is-2">
            <div id="filter">
                <p id="filter-title" class="box has-text-centered has-text-weight-bold is-size-7 is-uppercase is-marginless has-text-dark">
                    Filtrar Productos
                    <span class="icon is-pulled-right">
                        <i class='bx bx-filter-alt is-size-6'></i>
                    </span>
                </p>
                <div class="container box is-paddingless is-hidden-mobile" id="filter-container">
                    <div class="notification is-marginless has-background-white">
                        <p class="is-size-7 has-text-weight-bold">Marca</p>
                        <div class="select is-small is-info">
                            <select name="brand" class="is-capitalized">
                                <option value="">Filtrar Marca</option>
                                <%brands.forEach(brand =>{%>
                                    <option class="is-capitalized" value="<%=brand.name%>"><%=brand.name%></option>
                                <%}) %>
                            </select>
                        </div>
                        <a style="margin:3px 0 0 2px;" class="delete is-small is-pulled-right" id="brand-delete"></a>
                    </div>
                    <div class="notification is-marginless has-background-white">
                        <p class="is-size-7 has-text-weight-bold">Colores</p>
                        <% colors.forEach(color=>{%>
                            <a href="#" class="filter"><span class="color-container" color="<%=color.name%>" style="background-color: <%=color.code%>;border:solid 1px <%=color.code%>;"></span></a>
                        <%});%>
                        <a style="margin:3px 0 0 2px;" class="delete is-small is-pulled-right" id="color-delete"></a>
                    </div>
                    <div class="notification has-background-white is-marginless">
                        <p class="is-size-7 has-text-weight-bold">Género</p>
                            <div class="select is-small is-info">
                                <select name="gender" class="is-capitalized">
                                    <option value="">Filtrar Género</option>
                                    <%genders.forEach(gender =>{%>
                                        <option class="is-capitalized" value="<%=gender.name%>"><%=gender.name%></option>
                                    <%}) %>
                                </select>
                            </div>
                        <a style="margin:3px 0 0 2px;" class="delete is-small is-pulled-right" id="gender-delete"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="column is-10">
            <%if(object.logo!== undefined && object.logo!== null && object.logo!==''){%>
                <p class="has-text-centered"><img async src="<%=imgurl%><%=object.route%><%= object.logo %>" alt="<%=object.description%>"></p>
            <%}%>
            <!--            
            <%#if(typeof object.children == 'object' && object.children.length>0){%>
                <div class="container">
                    <div class="columns is-centered is-gapless">
                    <%# object.children.forEach(children=>{ %>
                        <%#if(children.active){%>
                          <div class="column has-text-centered subcat">
                            <a href="/ver/categoria/<%#=children.url%>"><span style="min-width:100%;" class="tag is-dark is-small is-uppercase"><%#=children.name%></span></a>
                          </div>
                        <%#}%>
                    <%#});%>
                    </div>
                </div>
                <br>
            <%#}%>
            -->
            <% let count = 0 %>
            <div class="container" itemscope itemtype="https://schema.org/ItemList">
            <% object.products.forEach((product)=>{ %>
                <%if(product.active){ %>
                    <div itemprop="itemListElement" itemscope itemtype="https://schema.org/Product" class="card card-catalog is-size-7">
                        <span class="is-hidden productid" itemprop="productID"><%=product.id%></span>
                        <div class="card-image has-badge-danger has-badge-rounded has-badge-medium" <%if(product.discount!==null && product.discount!==undefined){%>data-badge="<%=product.discount.value%>%"<%}%>>
                            <figure class="image is-256x256 is-inline-block">
                                <a itemprop="url" href="/list/product/<%=encodeURIComponent((product.name).replace(/\./g, '%2E'))%>/<%=encodeURIComponent(product.reference)%>"><%if(product.cover!==undefined){%><img async itemprop="image" style="justify-content: center;" src="<%=imgurl%>/images/products/<%=product.id%>/<%= product.cover.file %>" alt="<%product.manufacturer.name%> - <%product.reference%>"><%}%></a>
                            </figure>
                        </div>
                        <div class="card-content">
                                <div itemprop="description" class="is-hidden"><%-product.description%></div>
                                <div itemprop="disambiguatingDescription" class="is-hidden"><%-product.descriptionShort%></div>
                                <p><span class="is-pulled-right"><span class="is-hidden" itemprop="color"><%=product.mainColor.name%></span><span class="color-container" color="<%=product.mainColor.name%>" style="background-color: <%= product.mainColor.code %>;border:solid 1px <%= product.mainColor.code %>;"></span></span>
                                <span itemprop="brand" brand="<%=product.manufacturer.name%>" class="brand subtitle is-7 is-capitalized"><%=product.manufacturer.name%></span>&nbsp;-&nbsp;<span gender="<%=product.gender.name%>" class="gender subtitle is-7 is-capitalized"><%=product.gender.name%></span></p>
                                <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"><span itemprop="name" class="has-text-weight-bold is-uppercase"><%=product.name%></span></p>
                                <p><span class="is-hidden" itemprop="sku"><%=product.reference%></span>
                                <div itemprop="offers" itemscope itemtype="https://schema.org/Offer">
                                    <meta itemprop="priceCurrency" content="COP">
                                    <%if(product.discount!==null && product.discount!==undefined){%>
                                        <div itemprop="itemOffered" itemscope itemtype="https://schema.org/AggregateOffer">
                                            <span itemprop="highPrice" class="is-size-7 has-text-danger old-price">$<%= Math.round((product.price*(1+(product.tax.value/100)))).toLocaleString("es-CO");%></span>
                                            <span itemprop="lowPrice" class="is-size-6 has-text-dark has-text-weight-bold">$<%= Math.round(product.discount.price).toLocaleString("es-CO");%></span>
                                            <span class="is-hidden" itemprop="offerCount">1</span>
                                        </div>
                                        <span itemprop="price" class="is-hidden">$<%= Math.round(product.discount.price).toLocaleString("es-CO");%></span>
                                    <%}else{%>
                                        <span itemprop="price" class="is-size-6 has-text-dark has-text-weight-bold">$<%= Math.round((product.price*(1+(product.tax.value/100)))).toLocaleString("es-CO");%></span>
                                    <%}%>
                                </div>
                                </p>
                                <br>
                                <div class="dropdown is-fullwidth is-hoverable">
                                    <div class="dropdown-trigger">
                                        <button class="button is-small" product="<%=product.id%>" aria-haspopup="true" aria-controls="dropdown-menu">
                                            <span id="drop-selected" class="is-uppercase is-size-7" value="0" >Talla / Tamaño</span>
                                            <span class="icon is-small">
                                                <i class='bx bx-chevron-down'></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="dropdown-menu" id="dropdown-menu" role="menu">
                                        <div class="dropdown-content">
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <!--<div class="select is-primary is-size-7 is-fullwidth">
                                    <select class="is-uppercase s-variation" name="variations">
                                        <option style="min-height:30px;" value="0"></option>                                        
                                            <option class="is-uppercase" qty="<%#=v.quantity%>" value="<%#=v.id%>"><%#=v.variation.name%></option>
                                    </select>
                                </div>-->
                                <div class="buttons">
                                    <button id="push-to-cart" product="<%=product.id%>" disabled="disabled" class="button is-disabled is-size-7 is-right is-fullwidth">COMPRAR</button>
                                </div>
                        </div>
                    </div>
                <%} %>
            <%})%>
            </div>
        </div>        
    </div>
    <%}%>
</div>
<br><br>
<script>
    live('#filter-title','click',e=>{
        content = document.querySelector('#filter-container');
        if(!hasClass(content,'is-hidden')){
            addClass(content,'is-hidden');
            addClass(content,'is-hidden-mobile');
        }else{
            removeClass(content,'is-hidden');
            removeClass(content,'is-hidden-mobile');
        }
    });

    live('.filter','click', e =>{
        let color = e.target.getAttribute('color');
        let cards = document.querySelectorAll('.card');
        clearfilters();
        addClass(e.target.parentNode.parentNode,'has-background-warning');
        for(let c of cards){
            if(c.querySelector('.color-container').getAttribute('color')!==color){
                addClass(c,'is-hidden');
            }else{
                removeClass(c,'is-hidden');
            }
        }
        let selectb = document.querySelector('select[name="brand"]');
        selectb.value='';
    });

    let clearfilters = ()=>{
        for(let n of document.querySelectorAll('.notification')){
            removeClass(n,'has-background-warning');
            addClass(n,'has-background-white');
        }
    };

    live('.delete','click',e=>{
        let cards = document.querySelectorAll('.card');
        for(let c of cards){
            removeClass(c,'is-hidden');
        }
        let selectb = document.querySelector('select[name="brand"]');
        selectb.value='';
        let selectg = document.querySelector('select[name="gender"]');
        selectg.value='';
        clearfilters();
    });

    live('select[name="brand"]','change',e=>{
        
        let brand = e.target.value;
        let cards = document.querySelectorAll('.card');
        for(let c of cards){
            if(c.querySelector('.brand').getAttribute('brand')!==brand){
                addClass(c,'is-hidden');
            }else{
                removeClass(c,'is-hidden');
            }
        }
        clearfilters();
        addClass(e.target.parentNode.parentNode,'has-background-warning');
    });

    live('select[name="gender"]','change',e=>{
        let gender = e.target.value;
        let cards = document.querySelectorAll('.card');
        for(let c of cards){
            if(c.querySelector('.gender').getAttribute('gender')!==gender){
                addClass(c,'is-hidden');
            }else{
                removeClass(c,'is-hidden');
            }
        }
        clearfilters();
        addClass(e.target.parentNode.parentNode,'has-background-warning');
    });

</script>